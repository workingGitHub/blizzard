# 炉石传说需求分析分解

[TOC]

- - -


## 第一章：需求分析

### 1.1 总体需求分析
希望实现一个类似的炉石传说的网页版游戏，在原有功能的基础上实现如下扩展功能：
1. AI 学习训练（AI通过学习进行对战）
1. 卡牌自定义导入，通过json文件就可以导入一个可以使用的卡牌
1. 游戏模式的扩充，希望能对游戏模式，场景等进行扩充，实现多种不同的对战模式。比如：2V2，初始血量，水晶数，抽牌规则等进行变化

需要支持的原有功能如下：
- 登录功能
- 金币功能
- 开包功能
- 各卡牌效果功能需要保留
- 卡牌浏览
- 每日任务功能
- 天梯对战
- 竞技场对战
- 等。。。

### 1.2 登录功能
#### 1.2.1 场景分析
[场景1]
- [背景数据]：注册用户名：name1   密码：www
- [期望信息]：注册成功
- [背景数据]：注册用户名：name1   密码：www
- [期望信息]：注册失败，提示该用户已注册
- [背景数据]：登录用户名：name1   密码：www2
- [期望信息]：登录失败，显示登录界面
- [背景数据]：登录用户名：name1   密码：www1
- [期望信息]：登录成功，显示登录成功后的画面


#### 1.2.2 API接口
| Restful接口 	| 动作 	|  所带内容 | 返回信息	|
|--------		 |--------|--------	|--------  |
| /user/register |  GET   | 		| 注册网页界面|
| /user/register |  POST  |  用户名+密码	|- 成功 显示登录界面 -失败 显示失败信息|
| /user/login |  GET  | 	|显示登录界面|
| /user/login |  POST  | 用户名+密码	|- 成功 显示用户首页  -失败 显示失败信息|

#### 1.2.3 界面显示
注册网页界面  
```
用户名：【】   
密码：【】
注册(按钮)
```

登录网页界面  

```
用户名：【】   
密码：【】
登录(按钮)
```

登录成功界面
```
注销（按钮）
显示必要信息『用户名，金币』
卡牌商店
每日任务
拥有的卡包信息（用于开包）
卡牌编辑
天梯对战
竞技场对战
```

### 1.3 用户信息界面--注销
#### 1.3.1 注销功能
【场景1】  
【动作】：用户界面上点击注销按钮  
【期望信息】：返回登录界面


#### 1.3.2 API接口
| Restful接口 	| 动作 	|  所带内容 | 返回信息	|
|--------		 |--------|--------	|--------  |
| /user/logout |  Any  | 	|显示登录界面|


### 1.4 用户信息界面--卡牌商店
#### 1.4.1 卡牌商店
【场景1】  
【动作】：购买n包卡包  
【期望信息】：金币足够的情况下，返回成功，金币不够的情况下返回失败
#### 1.4.2 API接口
| Restful接口 	| 动作 	|  所带内容 | 返回信息	|
|--------		 |--------|--------	|--------  |
| /user/buy |  POST  | n=1	|成功，或者失败|

### 1.5 用户信息界面--每日任务
待分析

### 1.6 用户信息界面--卡包信息
#### 1.6.1 卡牌商店
【场景1】  
【动作】：打开卡包   
【期望信息】：如果没有卡包则失败，如果有卡包，则返回卡牌信息（5个）
#### 1.6.2 API接口
| Restful接口 	| 动作 	|  所带内容 | 返回信息	|
|--------		 |--------|--------	|--------  |
| /user/getcard  |  POST  |  |成功,返回json表示卡牌信息，或者失败|

### 1.7 用户信息界面--卡牌编辑
#### 1.7.1 卡牌商店
【场景1】  
【动作】：打开卡牌编辑  
【期望信息】：左侧显示所有拥有的卡牌，右侧显示拥有的卡组  

【场景2】  
【动作】：单击左侧卡牌内容  
【期望信息】：弹出卡牌详细信息  

【场景3】  
【动作】：单击左侧卡牌的卡组  
【期望信息】：左侧显示该卡组所包含的卡牌信息  

【场景4】  
【动作】：单击左侧卡牌的卡组的卡牌  
【期望信息】：弹出卡牌详细信息，（制作/分解/『移除|添加』）将该牌移除卡组

【场景5】  
【动作】：单击左侧卡牌的卡组的卡牌  
【期望信息】：弹出的详细信息中选择添加按钮，将该卡牌添加到卡组中

【场景6】  
【动作】：弹出的卡牌详细信息，按制作按钮  
【期望信息】：金币足够的情况下，制作一张卡牌，金币不够的话返回失败

【场景7】  
【动作】：弹出的卡牌详细信息，按分解按钮  
【期望信息】：如果拥有卡牌的情况下，则直接分解，否则返回失败

【场景8】  
【动作】：点击卡牌制作模式  
【期望信息】：非卡牌制作模式下，只显示拥有的卡牌。 卡牌制作模式下，显示所有卡牌

待补充

### 1.8 用户信息界面--天梯对战
待分析



## 第二章：技术选型
### 2.1 数据库选型
采用xorm框架下的sqlite3数据库


### 2.2 微服务架构
采用iris框架


## 第三章：方案设计
### 3.1 数据库选型操作--xrom
用户表：  

|字段		   | 字段类型 	|字段含义		|备注|
|--------	|--------	|----		|---|
|Id     	|  int64 	| 关键字&自增	| 默认即可  	|
|Username	|  String 	| 用户名 		| 唯一，默认  	|
|PhoneNO	|  String 	| 电话 		| 唯一，默认为空  |
|Email		|  String 	| 邮件箱 		| 唯一，默认为空  |
|Password	|  String 	| 密码 		|   			|
|Gold		|  int 		| 金币数 		|   	|
|Dusy		|  int 		| 粉尘数 		|   	|
|Card 		|  int 		| 卡包数 		|   	|
|IsJJCing 	|  Bool 	| 是否正在竞技场 | 否/是  |
|JJCdeck|  int64 | 竞技场卡组 | 卡组索引  |
|Deck01 |  int64 | 自定义卡组 | 卡组索引  |
|Deck02 |  int64 | 自定义卡组 | 卡组索引  |
|Deck03 |  int64 | 自定义卡组 | 卡组索引  |
|Deck04 |  int64 | 自定义卡组 | 卡组索引  |
|Deck05 |  int64 | 自定义卡组 | 卡组索引  |
|Deck06 |  int64 | 自定义卡组 | 卡组索引  |
|Deck07 |  int64 | 自定义卡组 | 卡组索引  |
|Deck08 |  int64 | 自定义卡组 | 卡组索引  |
|Deck09 |  int64 | 自定义卡组 | 卡组索引  |
|Deck10 |  int64 | 自定义卡组 | 卡组索引  |
|Deck11 |  int64 | 自定义卡组 | 卡组索引  |
|Deck12 |  int64 | 自定义卡组 | 卡组索引  |
|Deck13 |  int64 | 自定义卡组 | 卡组索引  |
|Deck14 |  int64 | 自定义卡组 | 卡组索引  |
|Deck15 |  int64 | 自定义卡组 | 卡组索引  |
|Deck16 |  int64 | 自定义卡组 | 卡组索引  |
|Deck17 |  int64 | 自定义卡组 | 卡组索引  |
|Deck18 |  int64 | 自定义卡组 | 卡组索引  |


卡组表：  

|字段		   | 字段类型 	|字段含义		|备注|
|--------	|--------	|----		|---|
|Id     	|  int64 	| 关键字&自增  | 默认即可  	|
|DeckType	|  String 	| 卡组类型  | 标准/竞技场/乱斗/狂野 |
|DeckName	|  String 	| 卡组名称 	    |   	|
|Card01 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card02 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card03 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card04 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card05 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card06 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card07 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card08 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card09 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card10 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card11 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card12 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card13 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card14 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card15 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card16 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card17 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card18 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card19 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card20 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card21 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card22 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card23 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card24 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card25 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card26 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card27 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card28 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card29 	|  String 	| 卡牌索引 		| 卡牌索引 |
|Card30 	|  String 	| 卡牌索引 		| 卡牌索引 |

  
  

卡牌表：  

|字段		   | 字段类型 	|字段含义		|备注|
|--------	|--------	|----		|---|
|CardID	    |  String 	|卡牌ID	| 主键  	|
|Version	|  int 	    |卡牌版本	|   	|
|CardName	|  String 	|卡牌名称 	|   	|
|CardSet	|  int 		|卡牌类组	|基础/经典/加基森|
|CardType	|  int 		|卡牌类型	|随从/法术/英雄卡/武器|
|Faction	|  int 		|卡牌派系	|通用/法..猎/污..玉莲帮|
|Rarity		|  int 		|稀有程度	|基本/基础/稀有/史诗/传说|
|Cost		|  int 		|卡牌费用   ||
|Atk		|  int 		|攻击力    |武器-攻击力/随从-攻击力|
|Health		|  int 		|血量	     |武器-耐久/随从-血量|
|AttackType |  int 		|攻击类型  |普通攻击/随机攻击/主动攻击|
|CardTextInHand|int|随从类型|嘲讽/圣盾/冲锋/隐藏/剧毒/法伤+1/免疫/吸血|
|CardRace	| int|随从种族|普通/野兽/元素/鱼人/恶魔/机械/龙/海盗 |
|Actor-Card	| String|Actor处理函数|在卡组中处理方式|
|Actor-Mudi	| String|Actor处理函数|在墓地中处理方式|
|Actor-Hand	| String|Actor处理函数|在手牌中处理方式|
|Actor-Battle| String|Actor处理函数|在战场中处理方式|




卡牌时机：
- 在卡组中
- 在墓地中
- 在手牌中
- 在战场中



卡牌动作
- 游戏开始时
- 卡牌抽到时
- 卡牌打出时
- 随从/英雄攻击时
- 随从死亡时
- 武器摧毁时


处理函数：  
【处理时机】：  
- 游戏开始时
- 卡牌抽到时
- 卡牌打出时
- 随从/英雄攻击时
- 随从死亡时
- 武器摧毁时
- 回合开始时
- 回合结束时
  
  
【处理范围】：
- 所有随从/所有敌方随从/所有已方随从/所有（随从，英雄）
- 随机选择/指定

【匹配器】：（满足条件后触发）  
- 待补充

【处理动作】：  
- 对范围目标，加攻击力
	- 参数int  【加攻击力】 
    - 参数bool  【是否当回合有效】
- 对范围目标，加生命力
	- 参数n 【加生命力】
- 生成卡牌
	- 参数String  【卡牌名称】  
    - 参数int  【选择复制到哪里】【对方手牌/对方牌库/本方手牌/本方牌库】
	- 参数int  【卡牌复制个数】
- 添加水晶
	- 参数int 【添加水晶个数】
	- 是否当前回合生效【是/否】
	- 添加水晶是否为空水晶【是/否】 
    
- 对范围目标，造成n点伤害
	- 参数int 【伤害值】
	- bool 【是否受到法强增强】


